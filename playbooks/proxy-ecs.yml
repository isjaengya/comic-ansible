---
- name: Prepare Python environment
  hosts: "{{host}}"
  gather_facts: no
  become: yes
  tasks:
    - name: Install Python dependencies
      raw: |
        if command -v apt-get >/dev/null 2>&1; then
          apt-get update && apt-get install -y python3 python3-pip python3-six
        elif command -v yum >/dev/null 2>&1; then
          yum install -y python3 python3-pip python3-six
        elif command -v zypper >/dev/null 2>&1; then
          zypper install -y python3 python3-pip python3-six
        else
          # Fallback: some distros enforce PEP 668; only break if necessary
          if command -v pip3 >/dev/null 2>&1; then
            pip3 install --break-system-packages six || true
          fi
        fi
      changed_when: false

    # 2) 现在能收集 facts 了
    - name: Gather facts
      setup:

- name: Nginx proxy server setup
  hosts: "{{host}}"
  gather_facts: no
  become: yes
  roles:
    - nginx